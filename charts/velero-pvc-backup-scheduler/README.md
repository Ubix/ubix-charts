# velero-pvc-backup-scheduler

![Version: 0.1.0](https://img.shields.io/badge/Version-0.1.0-informational?style=flat-square) ![AppVersion: 5.2.0](https://img.shields.io/badge/AppVersion-5.2.0-informational?style=flat-square)

Helm addon for adding a [Velero Scheduler](https://velero.io/docs/main/api-types/schedule/) that backups any PersistentVolumeClaim by using [CSI snapshots](https://velero.io/docs/main/csi/) given any existint helm deployment

## Example
```yaml
apiVersion: v2
name: mongodb
version: 0.1.0
dependencies:
  - name: mongodb
    alias: mongodb
    version: 13.6.2
    repository: https://charts.bitnami.com/bitnami
  # add velero scheduler to enable PVC backups
  - name: velero-pvc-backup-scheduler
    version: 0.1.0
    repository: https://ubix.github.io/ubix-charts
```

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| backupGarbageCollectionTTL | string | `"7days"` |  |
| backupHooks[0].includedNamespaces[0]. | string | `nil` |  |
| backupHooks[0].includedResources[0] | string | `"pods"` |  |
| backupHooks[0].labelSelector.matchLabels."app.kubernetes.io/name". | string | `nil` |  |
| backupHooks[0].name | string | `"mongodb-hook"` |  |
| backupHooks[0].pre[0].exec.command[0] | string | `"mongodump"` |  |
| backupHooks[0].pre[0].exec.command[1] | string | `"/bitnami/mongodb/bkp"` |  |
| backupHooks[0].pre[0].exec.container | string | `"mongodb"` |  |
| backupHooks[0].pre[0].exec.onError | string | `"Fail"` |  |
| backupHooks[0].pre[0].exec.timeout | string | `"5m"` |  |
| backupScheduleCron | string | `"0 0,8,16 * * *"` |  |
| veleroNamespace | string | `"addons"` |  |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.12.0](https://github.com/norwoodj/helm-docs/releases/v1.12.0)

## Restore process

To restore use either the [Velero CLI or the Restore CRDs](https://velero.io/docs/main/restore-reference/),
for other scenarios please check
- [Cluster Migration with Velero](https://velero.io/docs/main/migration-case/)
- [Cluster Disaster Recovery](https://velero.io/docs/main/disaster-case/)

### Restore via CRDs Example

```yaml
apiVersion: velero.io/v1
kind: Restore
metadata:
  # Restore name. May be any valid Kubernetes object name. Required.
  name: a-very-special-backup-0000111122223333
  # Restore namespace. Must be the namespace of the Velero server. Required.
  namespace: addons
spec:
  # The unique name of the Velero backup to restore from.
  backupName: a-very-special-backup
  # The unique name of the Velero schedule
  # to restore from. If specified, and BackupName is empty, Velero will
  # restore from the most recent successful backup created from this schedule.
  scheduleName: my-scheduled-backup-name
  includedNamespaces:
  - 'application-namespace'
  labelSelector:
    matchLabels:
      app: velero
      component: server
  hooks:
    # Array of hooks that are applicable to specific resources. Optional.
    resources:
    # Name is the name of this hook.
    - name: restore-hook-1
      includedNamespaces:
      - 'application-namespace'
      includedResources:
      - pods
      labelSelector:
        matchLabels:
          app.kubernetes.io/name: chart_app_name
      # An array of hooks to run during or after restores. Currently only "init" and "exec" hooks
      # are supported.
      postHooks:
      # The type of the hook. This must be "init" or "exec".
      - init:
          # An array of container specs to be added as init containers to pods to which this hook applies to.
          initContainers:
          - name: restore-hook-init1
            image: alpine:latest
            # Mounting volumes from the podSpec to which this hooks applies to.
            volumeMounts:
            - mountPath: /restores/pvc1-vm
              # Volume name from the podSpec
              name: pvc1-vm
            command:
            - /bin/ash
            - -c
            - echo -n "FOOBARBAZ" >> /restores/pvc1-vm/foobarbaz
          - name: restore-hook-init2
            image: alpine:latest
            # Mounting volumes from the podSpec to which this hooks applies to.
            volumeMounts:
            - mountPath: /restores/pvc2-vm
              # Volume name from the podSpec
              name: pvc2-vm
            command:
            - /bin/ash
            - -c
            - echo -n "DEADFEED" >> /restores/pvc2-vm/deadfeed
```
