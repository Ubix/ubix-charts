apiVersion: opentelemetry.io/v1alpha1
kind: OpenTelemetryCollector
metadata:
  name: {{ .Chart.Name }}
spec:
  image: public.ecr.aws/aws-observability/aws-otel-collector:v0.37.0
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: eks.amazonaws.com/compute-type
            operator: NotIn
            values:
            - fargate
  mode: {{ .Values.mode -}}
  {{ if eq .Values.mode "daemonset" }}
  priorityClassName: system-cluster-critical
  tolerations:
  - effect: NoSchedule
    operator: Exists
  {{- end }}
  config: |-
{{ .Values.config | toYaml | indent 4 }}
